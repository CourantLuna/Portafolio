import { useEffect, useState } from "react";
import { FaMoon, FaSun, FaBars, FaTimes } from "react-icons/fa";
import LanguageToggle from "./LanguageToggle";
import { useLanguage } from "../hooks/useLanguage";

const menuLinks = [
  { label: "nav.home", icon: <i className="fa-solid fa-house" />, tabIndex: 0 },
  { label: "nav.resume", icon: <i className="fa-solid fa-file-alt" />, tabIndex: 1 },
  { label: "nav.works", icon: <i className="fa-solid fa-cube" />, tabIndex: 2 },
  { label: "nav.blogs", icon: <i className="fa-brands fa-blogger" />, tabIndex: 3 },
  { label: "nav.contact", icon: <i className="fa-regular fa-address-book" />, tabIndex: 4 },
];

export default function AppBar() {
  const [menuOpen, setMenuOpen] = useState(false);
  // Estado para el theme
  const [theme, setTheme] = useState<"light" | "dark">("light");
  // Hook de idiomas
  const { t } = useLanguage();

  // Manejar navegación mobile
  const handleMobileNavigation = (tabIndex: number, tabLabel: string) => {
    // Disparar evento personalizado para comunicarse con TabsPanel
    const event = new CustomEvent('openMobileSheet', {
      detail: { tabIndex, tabLabel }
    });
    window.dispatchEvent(event);
    
    // Cerrar el menú
    setMenuOpen(false);
  };

  // Cambia el tema
  const toggleTheme = () => {
    if (theme === "dark") {
      setTheme("light");
      document.documentElement.classList.remove("dark");
      window.localStorage.setItem("theme", "light");
    } else {
      setTheme("dark");
      document.documentElement.classList.add("dark");
      window.localStorage.setItem("theme", "dark");
    }
  };

  // Al montar, lee la preferencia previa
  useEffect(() => {
    const userTheme = window.localStorage.getItem("theme");
    if (userTheme === "dark" || (!userTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      setTheme("dark");
      document.documentElement.classList.add("dark");
    } else {
      setTheme("light");
      document.documentElement.classList.remove("dark");
    }
  }, []);

  return (
    <header className="bg-white/80 dark:bg-gray-900/80 fixed top-0 left-0 w-full z-50 backdrop-blur-md border-b border-gray-200/20 dark:border-pink-500/20">
      <div className="max-w-[1400px] mx-auto flex items-center justify-between px-4 py-3">
        {/* Logo */}
        <div className="flex items-center gap-2">
          <svg 
          scale={2}
            xmlns="http://www.w3.org/2000/svg" 
            xmlnsXlink="http://www.w3.org/1999/xlink" 
            width="200" 
            height="55" 
            viewBox="0 0 150 41.25" 
            preserveAspectRatio="xMidYMid meet" 
            version="1.2"
            className="fill-gray-900 dark:fill-gray-100 hover:fill-pink-500 dark:hover:fill-pink-400 transition-all duration-300 hover:scale-105"
          >
            <g>
              <path d="M 106.316406 4.511719 C 106.242188 4.625 104.53125 9.683594 102.503906 15.761719 L 98.808594 26.828125 L 102.746094 26.71875 L 106.445312 15.652344 C 108.46875 9.570312 110.125 4.53125 110.125 4.457031 C 110.125 4.214844 106.445312 4.289062 106.316406 4.511719 Z M 106.316406 4.511719 "/>
              <path d="M 76.210938 4.960938 C 72.53125 5.757812 69.914062 7.898438 68.535156 11.226562 C 67.011719 14.871094 66.640625 20.988281 67.664062 25.472656 L 67.980469 26.8125 L 70.097656 26.8125 C 71.269531 26.8125 72.214844 26.792969 72.214844 26.753906 C 72.214844 26.738281 72.046875 26.179688 71.84375 25.527344 C 70.710938 21.902344 71.007812 15.390625 72.496094 12.175781 C 73.015625 11.023438 74.222656 9.664062 75.28125 9.050781 C 76.898438 8.082031 79.78125 7.785156 82.066406 8.324219 C 83.867188 8.753906 85.222656 9.722656 86.617188 11.636719 L 86.988281 12.136719 L 90.074219 10.054688 L 89.277344 8.921875 C 88.847656 8.304688 88.140625 7.507812 87.734375 7.15625 C 86.691406 6.261719 84.628906 5.277344 83.085938 4.960938 C 81.488281 4.625 77.734375 4.625 76.210938 4.960938 Z M 76.210938 4.960938 "/>
              <path d="M 19.777344 11.429688 L 7.382812 17.605469 L 7.382812 20.765625 L 19.71875 26.828125 L 26.484375 26.71875 L 18.789062 23 C 14.554688 20.953125 11.152344 19.222656 11.226562 19.148438 C 11.304688 19.074219 16.078125 16.710938 21.855469 13.921875 L 32.355469 8.808594 L 32.410156 7.023438 C 32.429688 6.039062 32.394531 5.238281 32.320312 5.257812 C 32.246094 5.257812 26.597656 8.046875 19.777344 11.429688 Z M 19.777344 11.429688 "/>
              <path d="M 39.511719 16.023438 L 39.511719 26.8125 L 43.414062 26.8125 L 43.414062 21.046875 L 56.605469 21.046875 L 56.605469 26.8125 L 60.507812 26.8125 L 60.507812 5.238281 L 56.605469 5.238281 L 56.605469 17.511719 L 43.414062 17.511719 L 43.414062 5.238281 L 39.511719 5.238281 Z M 39.511719 16.023438 "/>
              <path d="M 116.851562 7.003906 L 116.90625 8.789062 L 127.40625 13.921875 C 133.1875 16.730469 137.960938 19.09375 138.035156 19.167969 C 138.109375 19.242188 134.710938 20.972656 130.492188 23 L 122.796875 26.71875 L 126.160156 26.773438 L 129.542969 26.828125 L 135.714844 23.796875 L 141.902344 20.765625 L 141.902344 19.1875 L 141.882812 17.605469 L 129.488281 11.46875 C 122.667969 8.101562 117.019531 5.3125 116.945312 5.277344 C 116.871094 5.238281 116.832031 6.019531 116.851562 7.003906 Z M 116.851562 7.003906 "/>
              <path d="M 79.09375 21.324219 L 79.09375 23.089844 L 86.152344 23.089844 L 86.152344 26.8125 L 90.054688 26.8125 L 90.054688 19.558594 L 79.09375 19.558594 Z M 79.09375 21.324219 "/>
              <path d="M 54.75 30.453125 L 54.75 31.664062 L 54.339844 31.386719 C 53.820312 31.011719 52.539062 30.996094 52.035156 31.367188 C 51.515625 31.71875 51.03125 32.761719 51.03125 33.488281 C 51.03125 34.285156 51.53125 35.253906 52.148438 35.625 C 52.871094 36.035156 54.023438 36.015625 54.621094 35.550781 C 55.082031 35.179688 55.082031 35.179688 55.175781 35.550781 C 55.25 35.828125 55.4375 35.921875 55.84375 35.921875 C 56.328125 35.921875 56.421875 35.847656 56.421875 35.476562 C 56.421875 35.214844 56.347656 34.957031 56.234375 34.898438 C 56.121094 34.824219 56.050781 33.652344 56.050781 32 L 56.050781 29.230469 L 54.75 29.230469 Z M 54.339844 32.316406 C 54.675781 32.539062 54.75 32.78125 54.75 33.503906 C 54.75 34.230469 54.675781 34.472656 54.339844 34.695312 C 54.117188 34.863281 53.761719 34.992188 53.578125 34.992188 C 53.039062 34.992188 52.332031 34.15625 52.332031 33.503906 C 52.332031 32.855469 53.039062 32.015625 53.578125 32.015625 C 53.761719 32.015625 54.117188 32.148438 54.339844 32.316406 Z M 54.339844 32.316406 "/>
              <path d="M 62.925781 29.785156 C 62.925781 30.289062 62.980469 30.34375 63.484375 30.34375 C 63.984375 30.34375 64.039062 30.289062 64.039062 29.785156 C 64.039062 29.285156 63.984375 29.230469 63.484375 29.230469 C 62.980469 29.230469 62.925781 29.285156 62.925781 29.785156 Z M 62.925781 29.785156 "/>
              <path d="M 80.523438 29.507812 C 79.59375 29.824219 79.109375 30.269531 78.703125 31.179688 C 78.089844 32.5 78.292969 33.859375 79.238281 34.863281 C 80.335938 36.035156 81.710938 36.257812 82.882812 35.457031 L 83.550781 35.011719 L 83.550781 35.457031 C 83.550781 35.753906 83.664062 35.921875 83.828125 35.921875 C 84.054688 35.921875 84.109375 35.625 84.109375 34.34375 L 84.109375 32.761719 L 83.085938 32.761719 C 82.53125 32.761719 82.066406 32.835938 82.066406 32.949219 C 82.066406 33.039062 82.398438 33.132812 82.808594 33.132812 C 83.535156 33.132812 83.550781 33.152344 83.550781 33.785156 C 83.550781 34.304688 83.441406 34.507812 82.863281 34.898438 C 80.542969 36.460938 78.015625 33.710938 79.371094 31.070312 C 80.039062 29.804688 81.972656 29.507812 82.902344 30.53125 C 83.292969 30.957031 83.738281 31.011719 83.738281 30.660156 C 83.738281 30.34375 83.011719 29.675781 82.53125 29.546875 C 81.507812 29.285156 81.171875 29.265625 80.523438 29.507812 Z M 80.523438 29.507812 "/>
              <path d="M 121.015625 29.523438 C 120.734375 30.269531 121.015625 30.363281 121.515625 29.691406 C 121.832031 29.246094 121.832031 29.230469 121.496094 29.230469 C 121.292969 29.230469 121.070312 29.359375 121.015625 29.523438 Z M 121.015625 29.523438 "/>
              <path d="M 17.210938 32.667969 L 17.210938 35.921875 L 18.511719 35.921875 L 18.511719 33.132812 L 21.484375 33.132812 L 21.484375 35.921875 L 22.785156 35.921875 L 22.785156 29.414062 L 21.484375 29.414062 L 21.484375 32.015625 L 18.511719 32.015625 L 18.511719 29.414062 L 17.210938 29.414062 Z M 17.210938 32.667969 "/>
              <path d="M 30.332031 31.480469 C 29.699219 31.980469 29.289062 32.78125 29.289062 33.503906 C 29.289062 34.898438 30.351562 35.921875 31.78125 35.921875 C 32.800781 35.921875 33.9375 35.402344 33.9375 34.917969 C 33.9375 34.566406 33.101562 34.4375 32.785156 34.734375 C 32.652344 34.863281 32.320312 35.03125 32.039062 35.085938 C 31.648438 35.179688 31.429688 35.105469 31.074219 34.734375 C 30.796875 34.472656 30.589844 34.175781 30.589844 34.0625 C 30.589844 33.953125 31.277344 33.878906 32.449219 33.878906 L 34.308594 33.878906 L 34.308594 33.300781 C 34.308594 32.574219 33.84375 31.777344 33.191406 31.386719 C 32.429688 30.957031 30.945312 30.996094 30.332031 31.480469 Z M 32.636719 32.203125 C 33.34375 32.910156 33.136719 33.132812 31.800781 33.132812 C 30.441406 33.132812 30.238281 32.875 31.074219 32.222656 C 31.6875 31.738281 32.152344 31.71875 32.636719 32.203125 Z M 32.636719 32.203125 "/>
              <path d="M 40.253906 31.179688 C 40.253906 31.21875 40.664062 32.316406 41.183594 33.597656 C 41.90625 35.421875 42.074219 36.015625 41.945312 36.351562 C 41.757812 36.816406 41.277344 37.113281 40.980469 36.929688 C 40.886719 36.871094 40.8125 37.09375 40.8125 37.390625 C 40.8125 37.914062 40.867188 37.96875 41.386719 37.96875 C 42.074219 37.96875 42.59375 37.707031 42.855469 37.207031 C 42.96875 37.003906 43.523438 35.53125 44.082031 33.953125 L 45.085938 31.070312 L 44.492188 31.125 C 43.914062 31.179688 43.878906 31.21875 43.320312 33.039062 L 42.742188 34.898438 L 42.113281 32.984375 C 41.480469 31.085938 41.480469 31.085938 40.867188 31.085938 C 40.535156 31.085938 40.253906 31.125 40.253906 31.179688 Z M 40.253906 31.179688 "/>
              <path d="M 62.925781 33.503906 L 62.925781 35.921875 L 64.039062 35.921875 L 64.039062 31.085938 L 62.925781 31.085938 Z M 62.925781 33.503906 "/>
              <path d="M 91.429688 31.273438 C 91.003906 31.441406 90.707031 31.796875 90.855469 31.941406 C 90.910156 32 91.207031 31.90625 91.523438 31.757812 C 92.675781 31.164062 93.769531 31.589844 93.769531 32.632812 C 93.769531 33.226562 93.769531 33.226562 92.933594 33.171875 C 91.875 33.078125 91.261719 33.226562 90.800781 33.691406 C 90.316406 34.175781 90.332031 34.808594 90.816406 35.441406 C 91.132812 35.847656 91.355469 35.921875 92.082031 35.921875 C 92.695312 35.921875 93.121094 35.8125 93.457031 35.550781 C 93.921875 35.179688 93.921875 35.179688 94.011719 35.550781 C 94.070312 35.753906 94.238281 35.921875 94.386719 35.921875 C 94.589844 35.921875 94.628906 35.644531 94.570312 34.472656 C 94.460938 32.296875 94.367188 31.886719 93.828125 31.460938 C 93.324219 31.070312 92.171875 30.976562 91.429688 31.273438 Z M 93.734375 34.175781 C 93.847656 35.308594 92.171875 35.996094 91.355469 35.179688 C 90.484375 34.304688 91.226562 33.449219 92.75 33.542969 C 93.640625 33.597656 93.679688 33.617188 93.734375 34.175781 Z M 93.734375 34.175781 "/>
              <path d="M 101.390625 33.503906 C 101.390625 35.53125 101.429688 35.921875 101.667969 35.921875 C 101.894531 35.921875 101.949219 35.625 101.949219 34.34375 C 101.949219 32.910156 101.984375 32.707031 102.394531 32.296875 C 102.636719 32.054688 103.0625 31.796875 103.324219 31.71875 C 103.582031 31.664062 103.808594 31.496094 103.808594 31.347656 C 103.808594 30.9375 103.136719 31.050781 102.523438 31.570312 L 101.949219 32.054688 L 101.949219 31.570312 C 101.949219 31.273438 101.835938 31.085938 101.667969 31.085938 C 101.429688 31.085938 101.390625 31.480469 101.390625 33.503906 Z M 101.390625 33.503906 "/>
              <path d="M 111.015625 31.386719 C 109.566406 32.167969 109.585938 34.882812 111.054688 35.644531 C 112.058594 36.164062 113.804688 35.847656 114.082031 35.105469 C 114.25 34.679688 113.785156 34.640625 113.339844 35.03125 C 112.28125 35.996094 110.496094 35.050781 110.496094 33.523438 C 110.496094 32.464844 111.21875 31.644531 112.167969 31.644531 C 112.578125 31.644531 113.042969 31.796875 113.320312 32 C 114.046875 32.574219 114.363281 32.183594 113.65625 31.570312 C 112.988281 31.011719 111.851562 30.921875 111.015625 31.386719 Z M 111.015625 31.386719 "/>
              <path d="M 120.714844 33.503906 C 120.714844 35.792969 120.734375 35.921875 121.089844 35.921875 C 121.441406 35.921875 121.460938 35.792969 121.460938 33.503906 C 121.460938 31.21875 121.441406 31.085938 121.089844 31.085938 C 120.734375 31.085938 120.714844 31.21875 120.714844 33.503906 Z M 120.714844 33.503906 "/>
              <path d="M 128.96875 31.273438 C 128.539062 31.441406 128.242188 31.796875 128.390625 31.941406 C 128.449219 32 128.742188 31.90625 129.058594 31.757812 C 130.210938 31.164062 131.308594 31.589844 131.308594 32.632812 C 131.308594 33.226562 131.308594 33.226562 130.472656 33.171875 C 129.414062 33.078125 128.800781 33.226562 128.335938 33.691406 C 127.851562 34.175781 127.871094 34.808594 128.355469 35.441406 C 128.667969 35.847656 128.894531 35.921875 129.617188 35.921875 C 130.230469 35.921875 130.65625 35.8125 130.992188 35.550781 C 131.457031 35.179688 131.457031 35.179688 131.550781 35.550781 C 131.605469 35.753906 131.773438 35.921875 131.921875 35.921875 C 132.125 35.921875 132.164062 35.644531 132.109375 34.472656 C 131.996094 32.296875 131.902344 31.886719 131.363281 31.460938 C 130.863281 31.070312 129.710938 30.976562 128.96875 31.273438 Z M 131.273438 34.175781 C 131.382812 35.308594 129.710938 35.996094 128.894531 35.179688 C 128.019531 34.304688 128.761719 33.449219 130.285156 33.542969 C 131.179688 33.597656 131.214844 33.617188 131.273438 34.175781 Z M 131.273438 34.175781 "/>
            </g>
          </svg>
        </div>
        {/* Acciones derecha */}
        <div className="flex items-center gap-3">
          {/* Language toggle */}
          <LanguageToggle />
          
          {/* Theme toggle */}
          <button
            className="w-10 h-10 rounded-full flex items-center justify-center bg-gray-100 dark:bg-gray-800 hover:bg-gradient-to-r hover:from-pink-500 hover:to-pink-400 dark:hover:from-pink-600 dark:hover:to-pink-500 text-xl transition-all duration-300 shadow-sm dark:shadow-pink-500/10 hover:shadow-lg hover:shadow-pink-500/30 group"
            onClick={toggleTheme}
            aria-label={t('theme.toggle')}
          >
            {theme === "dark" ? (
              <FaSun className="text-yellow-400 group-hover:text-white transition-colors duration-300" />
            ) : (
              <FaMoon className="text-gray-700 dark:text-gray-300 group-hover:text-white transition-colors duration-300" />
            )}
          </button>
          {/* Botón hamburguesa solo en mobile */}
          <button
            className="w-10 h-10 rounded-full flex items-center justify-center bg-gradient-to-r from-pink-400 to-pink-500 dark:from-pink-500 dark:to-pink-600 text-white text-xl lg:hidden shadow-lg dark:shadow-pink-500/30 hover:scale-105 transition-all duration-300"
            onClick={() => setMenuOpen(true)}
            aria-label={t('menu.open')}
          >
            <FaBars />
          </button>
        </div>
      </div>
      {/* Menú mobile */}
      {menuOpen && (
        <div className="lg:hidden fixed inset-0 bg-black/50 dark:bg-black/70 z-50 flex justify-end backdrop-blur-sm">
          {/* Backdrop */}
          <div
            className="absolute inset-0 bg-black/30 dark:bg-black/50"
            onClick={() => setMenuOpen(false)}
            aria-label={t('menu.close')}
          />
          <nav className="w-full bg-gray-50 dark:bg-gray-900/95 dark:border-l dark:border-pink-500/20 shadow-xl h-full flex flex-col gap-6 relative animate-slide-down backdrop-blur-md">
            {/* Botón cerrar */}
            <button
              className="absolute top-4 right-4 w-9 h-9 rounded-full flex items-center justify-center bg-gray-200 dark:bg-gray-800 text-gray-600 dark:text-gray-300 text-xl hover:scale-110 transition-all duration-300"
              onClick={() => setMenuOpen(false)}
              aria-label={t('menu.close')}
            >
              <FaTimes />
            </button>
            {/* Opciones de menú */}
            <ul className="mt-16 w-full flex flex-col p-0 rounded-b-3xl bg-white dark:bg-gray-800/50 dark:backdrop-blur-sm">
              {menuLinks.map((link) => (
                <li key={link.label}>
                  <button
                    onClick={() => handleMobileNavigation(link.tabIndex, t(link.label))}
                    className="w-full flex items-center gap-3 px-4 py-3 transition text-gray-400 dark:text-gray-300 hover:bg-gradient-to-r hover:from-pink-400 hover:to-pink-500 dark:hover:from-pink-500 dark:hover:to-pink-600 hover:text-white font-semibold text-left"
                  >
                    {link.icon}
                    <span>{t(link.label)}</span>
                  </button>
                </li>
              ))}
            </ul>
          </nav>
        </div>
      )}
    </header>
  );
}
